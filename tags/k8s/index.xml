<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>k8s on é’äº‘å·</title>
    <link>https://mydream.ink/tags/k8s/</link>
    <description>Recent content in k8s on é’äº‘å·</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Wed, 06 Jan 2021 15:00:43 +0800</lastBuildDate><atom:link href="https://mydream.ink/tags/k8s/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Pyflink in Kubernetes</title>
      <link>https://mydream.ink/posts/cloud-native/kubernetes/pyflink-in-kubernetes/</link>
      <pubDate>Wed, 06 Jan 2021 15:00:43 +0800</pubDate>
      
      <guid>https://mydream.ink/posts/cloud-native/kubernetes/pyflink-in-kubernetes/</guid>
      <description>pyFlink on kubernetes  åœ¨ TKE ç¯å¢ƒä¸‹
 å‡†å¤‡å·¥ä½œ ä¸º flink åˆ›å»ºä¸“ç”¨çš„å‘½åç©ºé—´ã€ServiceAccountï¼Œå¹¶è®¾ç½®å¥½èµ„æºé…é¢
kubectl create ns flink kubectl -n flink create sa flink kubectl -n flink create role flink --verb=* --resource=*.* kubectl -n flink create rolebinding flink --role=flink --serviceaccount=flink:flink cat &amp;lt;&amp;lt; EOF &amp;gt; apiserver.crt # base é›†ç¾¤ apiserver è¯ä¹¦ -----BEGIN CERTIFICATE----- MIICyDCCAbCgAwIBAgIBADANBgkqhkiG9w0BAQsFADAVMRMwEQYDVQQDEwprdWJl cm5ldGVzMB4XDTIwMDMwNTA4MjYzOFoXDTMwMDMwMzA4MjYzOFowFTETMBEGA1UE AxMKa3ViZXJuZXRlczCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMq/ 6ae6qIZbchBK7b0AaP2714K+tuxtGnl7p3yNwlCgVEnZjfytAr8cvkIzxCBH8xBc vqV2vtDOy0r6HecbIPTkd0bGn6BXjqPp6XZY0ffFgyBhGv6/DD7x7aJIG+A8uSVk /yTGcahGQ9WOQ6CDWDjZvC+K9zkeNqhtj1wm9P/hQcECAQkQbkIqLUF/P8SF4b8N QlodYsrZIg9MDqgQDq744AoFPm/F6G2GfHs1DfesYMoSYQs6ECec0+N/Nf5Kx7XX KW+ARAGEZxC3X7bJmxWr5JSRmmS46rmrN/MUDpMBaWUwtxubVxtIwt1FIFlFqCYz MR9UtvZkTaL6oSd6Q18CAwEAAaMjMCEwDgYDVR0PAQH/BAQDAgKUMA8GA1UdEwEB /wQFMAMBAf8wDQYJKoZIhvcNAQELBQADggEBABXd9WbwOlhlqyFsr/2s9wgf86+/ oo05gZhybHtuKHYvSwzoxAeyaMFGn4b7S2okcLoo3EwjmAN2Pup/qhTtiqM9xNfa +GuN+NX4zjkra+T2NEywIykwhodaFiYB+r6xM0LIHANlKKT7kRtgzkq/s8ui6Wkt b94T8BpE5U3f6YGz/4NtbqpYS6XVjIIjfP5MxoHRCh8H2LXmWs9A2RlmuZAwo0M2 FJjxcfIgvHrgCerPogVcXYT23BavOhMFlx7Jck2GAbDg0HYTabZuLNkj9T1//raL aknXJxuLYHbZe6I1cbsIdXJjav5c83YgqGDKetcJdkQqMgk8lVWW7RIdLb0= -----END CERTIFICATE----- EOF kubectl config --kubeconfig=flink-kubeconfig set-cluster base --server=https://cls-xxxxxxx.</description>
    </item>
    
    <item>
      <title>è®°ä¸€æ¬¡ IPVS å¼•èµ·çš„ kubernetes æœåŠ¡å¼‚å¸¸</title>
      <link>https://mydream.ink/posts/cloud-native/kubernetes/record-a-kubernetes-service-exception-caused-by-ipvs/</link>
      <pubDate>Sun, 06 Dec 2020 17:14:02 +0800</pubDate>
      
      <guid>https://mydream.ink/posts/cloud-native/kubernetes/record-a-kubernetes-service-exception-caused-by-ipvs/</guid>
      <description>é—®é¢˜æè¿° åœ¨æˆ‘ä»¬çš„ç¯å¢ƒä¸­ï¼Œä¸šåŠ¡ A ä¼šè®¿é—®ä¸šåŠ¡ Bï¼ˆä¹Ÿå³ B æ˜¯ A çš„ä¸Šæ¸¸æœåŠ¡ï¼‰ï¼Œå½“ B å‘ç‰ˆæ—¶ï¼ŒA çš„è¯·æ±‚å¶å°”ä¼šå‡ºç° timeoutã€‚ç°è±¡çœ‹èµ·æ¥æ˜¯æµé‡è·¯ç”±åˆ°äº†å·²ç»ä¸èƒ½æä¾›æœåŠ¡çš„è€çš„ pod ä¸­ã€‚
é—®é¢˜å¤„ç† æ’æŸ¥ç‚¹ä¸€ å½“ pod ä¸‹çº¿æ—¶ï¼Œendpoint controller æœªåŠæ—¶å°† pod ä» endpoint ä¸­å–å‡ºï¼Œå¯¼è‡´æµé‡è¿›å…¥äº†æ—§çš„ podã€‚
ç”±äºé›†ç¾¤ master æ˜¯æ‰˜ç®¡éƒ¨ç½²çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡æœ‰åŠæ³•æŸ¥çœ‹ç›¸å…³æ—¥å¿—å’Œè´Ÿè½½ï¼Œæ±‚åŠ©äºè…¾è®¯äº‘çš„åŒæ—¶ï¼Œè‡ªå·±è¿™è¾¹ä¹Ÿåœ¨æ’æŸ¥ã€‚æ’æŸ¥åˆ†ä¸¤æ­¥è¿›è¡Œï¼Œç›‘æ§æœåŠ¡ B endpoint çš„å˜åŒ–ï¼ŒåŒæ—¶æ»šåŠ¨é‡å¯è¯¥æœåŠ¡ã€‚
  ç›‘æ§ ep å˜åŒ–
watch -n 1 kubectl -n production describe ep wk-dispatcher   é‡å¯æœåŠ¡
kubectl -n production rollout restart deployment wk-dispatcher   é€šè¿‡æ’æŸ¥å‘ç°ï¼Œè·Ÿ endpoint controller å¹¶æ²¡æœ‰å…³ç³»ï¼Œå› ä¸º ep å˜åŒ–å¾ˆåŠæ—¶ï¼ŒåŠ ä¸Šè‡³å°‘ 30 ç§’çš„ä¼˜é›…ç»ˆæ­¢æ—¶é—´ï¼ŒåŸºæœ¬å¯ä»¥ç¡®å®šåœ¨æœåŠ¡ç»“æŸå‰ï¼Œpod æ˜¯ä» ep ä¸­ç§»é™¤äº†çš„ã€‚</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ cert-manager è‡ªåŠ¨ç®¡ç† tls è¯ä¹¦</title>
      <link>https://mydream.ink/posts/cloud-native/kubernetes/use-cert-manager-in-kubernetes/</link>
      <pubDate>Sat, 09 Nov 2019 08:49:39 +0800</pubDate>
      
      <guid>https://mydream.ink/posts/cloud-native/kubernetes/use-cert-manager-in-kubernetes/</guid>
      <description>http åè®®æ˜¯ä¸€ä¸ªå…¨æ˜æ–‡ä¼ è¾“çš„åè®®ï¼Œä¸åŠ ä»»ä½•å¤„ç†çš„ http æŠ¥æ–‡å°†åœ¨å› ç‰¹ç½‘ä¸­è£¸å¥”ï¼Œåªè¦æœ‰äººå¯¹ç›‘å¬ä½ çš„æŠ¥æ–‡ï¼Œä½ æ‰€æœ‰éšç§å°†è¢«äººä¸€è§ˆæ— ä½™ã€‚Letâ€™s Encrypt æ˜¯ä¸€å®¶å…è´¹ã€å¼€æ”¾ã€è‡ªåŠ¨åŒ–çš„è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰ï¼Œä¸ºå…¬ä¼—çš„åˆ©ç›Šè€Œè¿è¡Œã€‚å®ƒæ˜¯ä¸€é¡¹ç”± Internet Security Research Groupï¼ˆISRGï¼‰æä¾›çš„æœåŠ¡ã€‚æœ¬ç€æƒ³è¦åˆ›å»ºä¸€ä¸ªæ›´å®‰å…¨ï¼Œæ›´å°Šé‡éšç§çš„ Web ç¯å¢ƒçš„åˆè¡·ï¼ŒLetâ€™s Encrypt ä»¥å°½å¯èƒ½å¯¹ç”¨æˆ·å‹å¥½çš„æ–¹å¼å…è´¹æä¾›ä¸ºç½‘ç«™å¯ç”¨ HTTPSï¼ˆSSL/TLSï¼‰æ‰€éœ€çš„æ•°å­—è¯ä¹¦ã€‚
ä½†æ˜¯ Letâ€™s Encrypt é¢å‘çš„è¯ä¹¦æœ‰ä¸ªç‰¹ç‚¹ï¼Œæœ‰æ•ˆæœŸåªæœ‰ä¸‰ä¸ªæœˆã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦é¢‘ç¹ç»­æœŸè¯ä¹¦ï¼Œå€˜è‹¥æ‰‹åŠ¨ç»­æœŸï¼Œæ— ç–‘ä¼šå¢åŠ è¿ç»´æˆæœ¬ã€‚æœ‰ä»€ä¹ˆæ–¹å¼å¯ä»¥ä¸ºæˆ‘ä»¬è‡ªåŠ¨é¢å‘è¯ä¹¦å—ï¼Ÿå½“ç„¶æœ‰ï¼ACME æ— ç–‘å°±æ˜¯æˆ‘ä»¬çš„æœ€ä½³é€‰æ‹©ã€‚
æœ‰ä¸€æ¬¾å¾ˆå¥½ç”¨çš„ ACME å®¢æˆ·ç«¯å« Certbotï¼Œå¯ä»¥å¸®åŠ©è‡ªåŠ¨é¢å‘ã€ç»­æœŸè¯ä¹¦ã€‚åœ¨ kubernetes çš„ç”Ÿæ€ä¸­æœ‰æ²¡æœ‰ä»€ä¹ˆå¥½çš„å·¥å…·èƒ½å¸®åŠ©æˆ‘ä»¬éå¸¸æ–¹ä¾¿åœ°ä½¿ç”¨è¯ä¹¦ä¹ˆï¼Ÿå½“ç„¶æœ‰ï¼Œé‚£å°±æ˜¯æœ¬æœŸä¸»é¢˜â€”â€”cert-managerã€‚
cert-manager æ˜¯æœ¬åœ° Kubernetes è¯ä¹¦ç®¡ç†æ§åˆ¶å™¨ã€‚å®ƒå¯ä»¥å¸®åŠ©ä»å„ç§æ¥æºé¢å‘è¯ä¹¦ï¼Œä¾‹å¦‚ Let&amp;rsquo;s Encryptï¼ŒHashiCorp Vaultï¼ŒVenafiï¼Œç®€å•çš„ç­¾åå¯†é’¥å¯¹æˆ–è‡ªç­¾åã€‚å®ƒå°†ç¡®ä¿è¯ä¹¦æœ‰æ•ˆå¹¶ä¸”æ˜¯æœ€æ–°çš„ï¼Œå¹¶åœ¨åˆ°æœŸå‰å°è¯•åœ¨é…ç½®çš„æ—¶é—´ç»­è®¢è¯ä¹¦ã€‚
åŸç†æ¯”è¾ƒç®€å•ï¼Œæœ¬æ–‡å°±ä¸è®²äº†ï¼Œä¸»è¦è°ˆè°ˆæ¥å®‰è£…å’Œä½¿ç”¨ã€‚
å®‰è£… YAML å®‰è£…   åˆ›å»º namespace
kubectl create namespace cert-manager   å®‰è£… crd å’Œ cert-manager
kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v0.11.0/cert-manager.yaml  å€¼å¾—è¯´æ˜çš„æ˜¯ï¼šåœ¨ kubernetes 1.15 ä»¥å‰çš„ç‰ˆæœ¬éœ€è¦åœ¨æ‰§è¡Œkubectl applyæ—¶æ·»åŠ ä¸€ä¸ªå‚æ•°--validate=falseï¼Œå¦åˆ™åœ¨åˆ›å»º CustomResourceDefinition èµ„æºæ—¶ä¼šæ”¶åˆ°ä¸ x-kubernetes-preserve-unknown-fields å­—æ®µæœ‰å…³çš„éªŒè¯é”™è¯¯ã€‚
   helm å®‰è£… ä¾æ¬¡æ‰§è¡Œä¸‹è¿°å‘½ä»¤ï¼š</description>
    </item>
    
    <item>
      <title>è‡ªåŠ¨åŒ–è¿ç»´ä¹‹è‡ªåŠ¨æ„å»º</title>
      <link>https://mydream.ink/posts/devops/sonarqube-and-gitlab/</link>
      <pubDate>Sat, 09 Nov 2019 08:32:31 +0800</pubDate>
      
      <guid>https://mydream.ink/posts/devops/sonarqube-and-gitlab/</guid>
      <description>ç‰ˆæœ¬è¯´æ˜  gitlab: 11.4.5 sonarqube: 8.0-community-beta helm: v3.0.0-rc.2 sonar-gitlab-plugin: 4.1.0-SNAPSHOT chart: 3.2.2  é¢„å¤„ç†  å¯ç”¨çš„ ingress controller åŸŸåï¼šç¡®ä¿å¯¹åº”çš„åŸŸåsonar.example.com èƒ½å¤Ÿè®¿é—®åˆ° ingress å·²ç»æœ‰ gitlabï¼Œå¹¶ä¸”é…ç½®å¥½äº†ä¸€ä¸ªå…¨å±€å¯ç”¨çš„ Kubernetes ç¯å¢ƒçš„ runner  å®‰è£… sonarqube æ²¡æœ‰å·²ç»å­˜åœ¨çš„æ•°æ®åº“ç”¨äºç›¸å…³æ•°æ®å­˜å–ï¼Œæ‰€ä»¥åœ¨å®‰è£… sonarqube çš„åŒæ—¶ï¼Œè¿˜å°†æ ¹æ®ä¾èµ–å®‰è£… postgresqlã€‚
è‡ªå®šä¹‰å˜é‡ è¿›å…¥stable/sonarqubeï¼Œåˆ›å»º custom.yaml æ–‡ä»¶ï¼š
image: tag: 8.0-community-beta ingress: enabled: true hosts: - name: sonar.example.com annotations: kubernetes.io/ingress.class: nginx # é€‰æ‹©æŒ‡å®šçš„ ingress controller cert-manager.io/cluster-issuer: letsencrypt-stagging # ä½¿ç”¨æå‰åˆ›å»ºå¥½çš„å¯ç”¨çš„ Issue/ClusterIssue acme.cert-manager.io/http01-edit-in-place: &amp;#34;true&amp;#34; # é¢å‘è¯ä¹¦æ—¶ä¾æ‰˜åŸåŸæœ‰çš„ ingress è€Œä¸æ–°å»º tls: - hosts: - sonar.example.com secretName: sonar-tls persistence: enabled: true accessMode: ReadWriteOnce size: 10Gi plugins: install: # é¢„è£… sonar-gitlab-plugin æ’ä»¶ - &amp;#34;https://github.</description>
    </item>
    
    <item>
      <title>è·¨ VPC éƒ¨ç½² zookeeper observer</title>
      <link>https://mydream.ink/posts/middleware/zookeeper/deploy-zookeeper-observer-across-vpc/</link>
      <pubDate>Sat, 02 Nov 2019 09:15:21 +0800</pubDate>
      
      <guid>https://mydream.ink/posts/middleware/zookeeper/deploy-zookeeper-observer-across-vpc/</guid>
      <description>åœºæ™¯è¯´æ˜ æŸäº‘æä¾›å•†ç½‘ç»œæŠ€æœ¯æ›´æ–°è¿­ä»£ï¼Œé—ç•™ä¸‹äº†åŸºç¡€ç½‘ç»œå’Œ VPC ç½‘ç»œä¸¤ç§ç½‘ç»œæ¶æ„ï¼Œæˆ‘ä»¬å…¬å¸ç›®å‰çš„æœåŠ¡å™¨è¿˜å¤§å¤šéƒ½åœ¨åŸºç¡€ç½‘ç»œä¸­ã€‚æˆ‘åœ¨æ–°ç¯å¢ƒä¸­æ­å»ºäº† kubernetes é›†ç¾¤ï¼Œå¹¶åœ¨ä¸Šé¢éƒ¨ç½²äº†é«˜å¯ç”¨çš„ zookeeper é›†ç¾¤ã€‚é…ç½®ä¸­å¿ƒæ–¹æ¡ˆæ˜¯ä¸€ä¸ªå…¨å±€æ–¹æ¡ˆï¼Œå…¬å¸å¤§å¤§å°å°çš„é¡¹ç›®é™†é™†ç»­ç»­éƒ½ä¼šä¸Šï¼Œä¸ºäº†ä¾¿äºç»´æŠ¤ä¸è¿ç§»ï¼Œæˆ‘ä»¬é‡‡ç”¨ä¸€å¥—ç¯å¢ƒç»Ÿä¸€ç®¡ç†ã€‚æ­¤æ—¶ï¼Œé›†ç¾¤å†…çš„ zookeeper å·²ç»ç”± helm éƒ¨ç½²å®Œæˆã€‚
éœ€æ±‚  ä¸€å°å·²ç»å®‰è£…äº† docker å’Œ docker-compose çš„ä½äºåŸºç¡€ç½‘ç»œæœåŠ¡å™¨ï¼ˆä½œä¸º zookeeper observerï¼Œä¸ºé¿å…å•ç‚¹æ•…éšœæœ€å¥½å¤‡ä¸¤å°åŠä»¥ä¸Š) å·²ç»å®‰è£…å¥½ä¸‰ä¸ªç»“ç‚¹çš„ zookeeper çš„ kubernetes çš„é›†ç¾¤  æ“ä½œæµç¨‹ 1. åŸºç¡€ç½‘ç»œäº’é€š è¿™ä¸ªæ­¥éª¤å…·ä½“æ€ä¹ˆåšæˆ‘å°±ä¸æäº†ï¼Œæ¯ä¸ªäº‘æœåŠ¡å•†å¯èƒ½ä¸åŒï¼Œä½†å¹¶ä¸æ˜¯ä»€ä¹ˆéš¾ç‚¹ã€‚è¾¾åˆ°çš„æ•ˆæœå°±æ˜¯å°† kubernetes é›†ç¾¤æ‰€åœ¨çš„ VPC å’Œ observer æœåŠ¡å™¨å¯ä»¥äº’è”äº’é€š
2. å‘å†…ç½‘æš´éœ² zk é›†ç¾¤ç›¸å…³æœåŠ¡ åˆ©ç”¨ statefulSet ä¼šä¸ºæ¯ä¸ª pod ç”Ÿæˆçš„ä¸€ä¸ªç‰¹æ®Šçš„ labelï¼Œä¸ºæ¯ä¸€ä¸ª zookeeper çš„ pod å»ºç«‹å†…ç½‘ LB ç±»å‹çš„ Serviceã€‚
è¿™é‡Œæœ‰ä¸€ä¸ªåˆ›å»ºå…¶ä¸­ä¸€ä¸ª svc çš„ä¾‹å­ï¼š
apiVersion: v1 kind: Service metadata: annotations: # è¿™é‡Œè¾¹æ˜¯ä¸äº‘æœåŠ¡å•†å¼ºç›¸å…³çš„ä¸€äº›é…ç½®ï¼Œä¸å…·å¤‡é€šç”¨æ€§ä½†ä»ç„¶å…·æœ‰å‚è€ƒä»·å€¼ï¼Œè¿™é‡Œéœ€è¦é…ç½®ä¸ç„¶é»˜è®¤æ˜¯å…¬ç½‘ LB service.kubernetes.io/qcloud-loadbalancer-clusterid: cls-xxxxxx # ç¡®å®š tke é›†ç¾¤ service.</description>
    </item>
    
    <item>
      <title>Kubernetes ä¸­éƒ¨ç½²é«˜å¯ç”¨çš„ Zookeeper</title>
      <link>https://mydream.ink/posts/middleware/zookeeper/deploy-zookeeper-ha-in-kubernetes/</link>
      <pubDate>Sat, 02 Nov 2019 08:01:06 +0800</pubDate>
      
      <guid>https://mydream.ink/posts/middleware/zookeeper/deploy-zookeeper-ha-in-kubernetes/</guid>
      <description>æœ¬æ–‡ä¸»è¦ä½¿ç”¨ helm chart è¿›è¡Œ zookeeper çš„é«˜å¯ç”¨éƒ¨ç½²ã€‚
ç¯å¢ƒè¯´æ˜ æœ¬æ–‡ä½¿ç”¨çš„æ˜¯ TKE æ‰˜ç®¡ç¯å¢ƒï¼Œåœ¨è¯¥ç¯å¢ƒä¸­å®‰ä¸­äº† cbs-csi çš„ operatorï¼Œä¸ºäº†æ–¹ä¾¿æŒä¹…å·å¤‡ä»½ï¼Œåæ–‡ä¸­çš„æŒä¹…åŒ–å­˜å‚¨ä¼šç»Ÿä¸€é‡‡ç”¨ã€‚CSIçš„è§£å†³æ–¹æ¡ˆåœ¨å„ç§ç¯å¢ƒä¸­éƒ½ä¼šæœ‰ï¼Œæˆ‘ä»…æè¿° cbsã€‚
  kubernetes ç‰ˆæœ¬ï¼šv1.14.3-tke.4
  helm ç‰ˆæœ¬ï¼šv2.10.0ï¼ˆTKEæ§åˆ¶å°æ”¯æŒçš„ç‰ˆæœ¬ï¼‰
  æŒ‰æ­¥éª¤å®‰è£…å¥½çš„ cbs-csi
 å€¼å¾—è¯´æ˜çš„æ˜¯ cbs å­˜å‚¨ä¸å¯è·¨å¯ç”¨åŒºæŒ‚è½½ï¼Œé»˜è®¤æƒ…å†µä¸‹å…ˆå»ºå­˜å‚¨å†å»º pod çš„æ–¹å¼æ— æ³•æ»¡è¶³ç”Ÿäº§éœ€è¦ï¼Œæ‰€ä»¥æ‰å¼•å…¥çš„ cbs-csiã€‚ä½†åœ¨å»ºç«‹ storageClass æ—¶è¦æ³¨æ„åŠ å…¥ volumeBindingMode: WaitForFirstConsumer ä»¥ä¿è¯ pod å®Œæˆè°ƒåº¦ä¹‹åå†åˆ›å»ºå·ï¼Œä»è€Œä½¿å¾—å­˜å‚¨ä¸ç”¨å½±å“ pod çš„è°ƒåº¦ã€‚sc å‚è€ƒå¦‚ä¸‹ï¼š
 apiVersion: storage.k8s.io/v1 kind: StorageClass metadata: annotations: storageclass.beta.kubernetes.io/is-default-class: &amp;#34;true&amp;#34; name: cbs-csi-topo parameters: diskType: CLOUD_PREMIUM provisioner: com.tencent.cloud.csi.cbs reclaimPolicy: Delete volumeBindingMode: WaitForFirstConsumer   å·²ç»éƒ¨ç½²å¥½äº†çš„ prometheus çš„ç›‘æ§æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ serviceMonitor è¿™æ ·çš„ CRD</description>
    </item>
    
    <item>
      <title>è‡ªåŠ¨åŒ–è¿ç»´ä¹‹è‡ªåŠ¨æ„å»º</title>
      <link>https://mydream.ink/posts/devops/auto-devops-auto-build/</link>
      <pubDate>Sun, 08 Sep 2019 18:37:36 +0800</pubDate>
      
      <guid>https://mydream.ink/posts/devops/auto-devops-auto-build/</guid>
      <description>æœ¬æ–‡ä¾›è‡ªå·±è®°å½•å­¦ä¹ ï¼Œæˆ‘ä¼šå°½é‡ä¿è¯æ–‡ç« å‡†ç¡®æ— è¯¯ï¼Œä½†å› æœ¬äººæ°´å¹³æœ‰é™ï¼Œå¦‚æœä¸å¹¸äº§ç”Ÿä»»ä½•é”™è¯¯ï¼Œæœ›è¯»è€…ä¸åèµæ•™ã€‚
æµ…æ gitlab-runner ç›¸å…³é…ç½® åœ¨ gitlab-runner ä¸­æ¯ä¸ª runner éƒ½éœ€è¦æŒ‡å®š executorï¼Œexecutor æœ‰ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š
 SSH Shell Parallels VirtualBox Docker Docker Machine (auto-scaling) Kubernetes Custom  æˆ‘ä»¬ä¼šå°† gitlab-runner éƒ¨ç½²åœ¨ kubernetes é›†ç¾¤ä¸­ï¼Œæ‰€ä»¥æ­¤å¤„é€‰ç”¨ kubernetes ä½œä¸º executorã€‚æœ‰å…³è¯¥ executor çš„é…ç½®æ–¹å¼ï¼Œåœ¨å®˜æ–¹æ–‡æ¡£ä¸­æœ‰è¯¦ç»†è¯´æ˜ï¼Œæ­¤å¤„å°±æ­¤æ¬¡é…ç½®æ‰€éœ€è¦çš„è¿›è¡Œç®€å•è¯´æ˜ï¼Œå…¶å®ƒçš„å†è§†æƒ…å†µè¿›è¡Œè¡¥å……ã€‚
ä¸å…¶å®ƒç±»å‹çš„ executor ä¸€æ ·ï¼Œkubernetes ä¹Ÿéœ€è¦æ ¹æ® gitlab ä»“åº“çš„ url å’Œ token å¯¹ runner è¿›è¡Œæ³¨å†Œæ–¹å¯ä½¿ç”¨ã€‚æ³¨å†Œåä¼šæœ‰ä¸€ä¸ªå¸¸é©»çš„ pod ï¼ˆæˆ‘å§‘ä¸”å«å®ƒ runner æœåŠ¡ç«¯ï¼‰å¯¹æ¥è‡ªäº gitlab çš„ pipeline ä»»åŠ¡è¿›è¡Œç›‘å¬ï¼Œå½“ç›‘å¬åˆ°æœ‰æ–°çš„ä»»åŠ¡éœ€è¦æ‰§è¡Œæ—¶ï¼Œå°±ä¼šåˆ›å»ºæ–°çš„ pipeline è·‘ .gitlab-ci.yml ä¸Šå¯¹åº”çš„jobã€‚æ‰€ä»¥ runner æœåŠ¡ç«¯ç›¸å…³è”çš„ ServieAccount ä¸€å®šéœ€è¦å…·å¤‡å¯¹åº”çš„ namespace çš„ pod çš„åˆ›å»ºçš„æƒé™ã€‚
é…ç½®ä¸€ä¸ª runner æœ‰å¤šç§æ–¹å¼ï¼ŒåŒ…æ‹¬å¯åŠ¨å‚æ•°ã€ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ç­‰ã€‚è¿™å…¶ä¸­é…ç½®æ–‡ä»¶çš„åŠŸèƒ½æœ€å¼ºï¼Œå‚æ•°å¯é…ç½®é¡¹è¾ƒç¯å¢ƒå˜é‡ç¨å¤šï¼ˆæˆ–è®¸å®ƒä»¬å…·æœ‰ç›¸åŒçš„èƒ½åŠ›ï¼Œåªæ˜¯æˆ‘æ²¡æœ‰å‘ç°ï¼Œå¦‚æœä½ çŸ¥é“æ¬¢è¿å¸®å¿™è¡¥å……ï¼‰ã€‚é€šè¿‡gitlab-runner help registerå‘½ä»¤æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æ‰€æœ‰çš„å¯åŠ¨å‚æ•°å’Œç¯å¢ƒå˜é‡ï¼Œå‚æ•°ä¸ç¯å¢ƒå˜é‡ä¹‹é—´çš„å…³ç³»è¯·å‚ç…§å‚æ•°ä¸ç¯å¢ƒå˜é‡å¯¹ç…§è¡¨ã€‚</description>
    </item>
    
    <item>
      <title>åœ¨ Mac ä¸Šä½¿ç”¨ Docker è‡ªå¸¦çš„ Kubernetes</title>
      <link>https://mydream.ink/posts/cloud-native/kubernetes/use-kubernetes-from-docker-on-mac/</link>
      <pubDate>Fri, 12 Jul 2019 20:23:13 +0800</pubDate>
      
      <guid>https://mydream.ink/posts/cloud-native/kubernetes/use-kubernetes-from-docker-on-mac/</guid>
      <description>Mac å®‰è£… Docker çš„æ–¹æ³•ä¸å†èµ˜è¿°ï¼Œå¾ˆç®€å•ï¼Œå®˜æ–¹ä¸‹è½½å®‰è£…å³å¯ã€‚
å®‰è£…å®Œæˆåï¼Œkubectlçš„äºŒè¿›åˆ¶æ–‡ä»¶å°±å·²ç»å­˜åœ¨äº†ã€‚æˆ‘ä»¬ä»…éœ€è¦ä¸‹è½½é•œåƒï¼Œå¼€å¯ kubernetesã€‚
ä¸‹è½½é•œåƒ æŸ¥çœ‹ä¸€ä¸‹ä½ çš„ Docker å’Œ Kubernetes ç‰ˆæœ¬ï¼š
ä½¿ç”¨ä»¥ä¸‹è„šæœ¬ï¼Œè®°å¾—å°†é•œåƒç‰ˆæœ¬æ”¹æˆä½ æ‰€éœ€è¦çš„ğŸ
#!/bin/bash  set -e KUBE_VERSION=v1.10.11 KUBE_PAUSE_VERSION=3.1 ETCD_VERSION=3.1.12 DNS_VERSION=1.14.8 DOCKER_TOOL_VERSION=v0.4.12 GCR_URL=k8s.gcr.io ALIYUN_URL=registry.cn-hangzhou.aliyuncs.com/google_containers images=(kube-proxy-amd64:${KUBE_VERSION} kube-scheduler-amd64:${KUBE_VERSION} kube-controller-manager-amd64:${KUBE_VERSION} kube-apiserver-amd64:${KUBE_VERSION} pause-amd64:${KUBE_PAUSE_VERSION} etcd-amd64:${ETCD_VERSION} k8s-dns-sidecar-amd64:${DNS_VERSION} k8s-dns-kube-dns-amd64:${DNS_VERSION} k8s-dns-dnsmasq-nanny-amd64:${DNS_VERSION}) for image in ${images[@]} ; do docker pull ${ALIYUN_URL}/${image} docker tag ${ALIYUN_URL}/${image} ${GCR_URL}/${image} docker rmi ${ALIYUN_URL}/${image} done # æ‹‰å– Docker ç›¸å…³é•œåƒ docker pull docker/kube-compose-api-server:${DOCKER_TOOL_VERSION} docker pull docker/kube-compose-controller:${DOCKER_TOOL_VERSION} æ‰§è¡Œè¯¥è„šæœ¬ï¼Œå°†ä»é˜¿é‡Œé•œåƒåº“è·å¾—æ‰€éœ€é•œåƒã€‚
å¯åŠ¨ Kubernetes åŠŸèƒ½ æ‰“å¼€ Docker é…ç½®é¢æ¿ï¼Œè¯·è‡³å°‘å‹¾é€‰ Enable Kubernetes ä»¥å¼€å¯ Kubernetes æœåŠ¡ã€‚</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ kubeadm å®‰è£… Kubernetes 1.10.0</title>
      <link>https://mydream.ink/posts/cloud-native/kubernetes/kubeadm/</link>
      <pubDate>Fri, 09 Mar 2018 00:00:00 +0000</pubDate>
      
      <guid>https://mydream.ink/posts/cloud-native/kubernetes/kubeadm/</guid>
      <description>kuberneteså¯ä»¥ä½¿ç”¨å¤šç§å®¹å™¨runtimeï¼Œæ­¤å¤„ä½¿ç”¨å½“å‰æœ€å¸¸è§çš„dockerã€‚
å®‰è£…docker åœ¨å„ç§æœºå™¨ä¸Šå®‰è£…dockerçš„æ–¹å¼ä¸åŒï¼Œæˆ‘æ›¾ç¿»è¯‘è¿‡ä¸€ç¯‡ubuntuå®‰è£…dockerçš„æ–‡ç« ï¼Œè¿˜æœ‰ä¸€äº›æ²¡æ¥çš„åŠç¿»è¯‘çš„ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚æ¨èçš„dockerç‰ˆæœ¬ä¸ºv1.12ï¼Œv1.11, v1.13 å’Œ 17.03 ä¹Ÿè¡Œï¼Œå…¶å®ƒçš„å®˜æ–¹å°±æ²¡æµ‹è¯•è¿‡äº†ï¼Œä¸è¿‡æˆ‘ä½¿ç”¨å½“å‰æœ€æ–°çš„v18.03ä¹Ÿè¡Œã€‚
dockerå®˜æ–¹  ä½¿ç”¨Ubuntuå®‰è£…docker-ce Macå’ŒWindowsæ¡Œé¢å®‰è£…docker-ce  ä¸‹è½½Macç‰ˆæœ¬çš„docker-ceï¼Œæ‰§è¡Œå³å®‰è£… ä¸‹è½½Windowsç‰ˆæœ¬çš„docker-ceï¼Œæ‰§è¡Œå³å¯å®‰è£…   CentOSå®‰è£…docker-ce Fedoraå®‰è£…docker-ce äºŒè¿›åˆ¶å®‰è£…æ–¹å¼  kubernetesæ¨è   Ubuntu/Debian/HypriotOS ä»Ubuntuçš„åº“å®‰è£…
apt-get update apt-get install -y docker.io ä½¿ç”¨dockeråº“å®‰è£…v17.03
apt-get update apt-get install -y \  apt-transport-https \  ca-certificates \  curl \  software-properties-common curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add - add-apt-repository \  &amp;#34;deb https://download.docker.com/linux/$(. /etc/os-release; echo &amp;#34;$ID&amp;#34;)\ $(lsb_release -cs)\ stable&amp;#34; apt-get update &amp;amp;&amp;amp; apt-get install -y docker-ce=$(apt-cache madison docker-ce | grep 17.</description>
    </item>
    
  </channel>
</rss>
