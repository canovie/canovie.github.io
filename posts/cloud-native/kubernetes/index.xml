<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Kubernetes on é’äº‘å·</title>
    <link>https://mydream.ink/posts/cloud-native/kubernetes/</link>
    <description>Recent content in Kubernetes on é’äº‘å·</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Wed, 06 Jan 2021 15:00:43 +0800</lastBuildDate><atom:link href="https://mydream.ink/posts/cloud-native/kubernetes/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Pyflink in Kubernetes</title>
      <link>https://mydream.ink/posts/cloud-native/kubernetes/pyflink-in-kubernetes/</link>
      <pubDate>Wed, 06 Jan 2021 15:00:43 +0800</pubDate>
      
      <guid>https://mydream.ink/posts/cloud-native/kubernetes/pyflink-in-kubernetes/</guid>
      <description>pyFlink on kubernetes  åœ¨ TKE ç¯å¢ƒä¸‹
 å‡†å¤‡å·¥ä½œ ä¸º flink åˆ›å»ºä¸“ç”¨çš„å‘½åç©ºé—´ã€ServiceAccountï¼Œå¹¶è®¾ç½®å¥½èµ„æºé…é¢
kubectl create ns flink kubectl -n flink create sa flink kubectl -n flink create role flink --verb=* --resource=*.* kubectl -n flink create rolebinding flink --role=flink --serviceaccount=flink:flink cat &amp;lt;&amp;lt; EOF &amp;gt; apiserver.crt # base é›†ç¾¤ apiserver è¯ä¹¦ -----BEGIN CERTIFICATE----- MIICyDCCAbCgAwIBAgIBADANBgkqhkiG9w0BAQsFADAVMRMwEQYDVQQDEwprdWJl cm5ldGVzMB4XDTIwMDMwNTA4MjYzOFoXDTMwMDMwMzA4MjYzOFowFTETMBEGA1UE AxMKa3ViZXJuZXRlczCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMq/ 6ae6qIZbchBK7b0AaP2714K+tuxtGnl7p3yNwlCgVEnZjfytAr8cvkIzxCBH8xBc vqV2vtDOy0r6HecbIPTkd0bGn6BXjqPp6XZY0ffFgyBhGv6/DD7x7aJIG+A8uSVk /yTGcahGQ9WOQ6CDWDjZvC+K9zkeNqhtj1wm9P/hQcECAQkQbkIqLUF/P8SF4b8N QlodYsrZIg9MDqgQDq744AoFPm/F6G2GfHs1DfesYMoSYQs6ECec0+N/Nf5Kx7XX KW+ARAGEZxC3X7bJmxWr5JSRmmS46rmrN/MUDpMBaWUwtxubVxtIwt1FIFlFqCYz MR9UtvZkTaL6oSd6Q18CAwEAAaMjMCEwDgYDVR0PAQH/BAQDAgKUMA8GA1UdEwEB /wQFMAMBAf8wDQYJKoZIhvcNAQELBQADggEBABXd9WbwOlhlqyFsr/2s9wgf86+/ oo05gZhybHtuKHYvSwzoxAeyaMFGn4b7S2okcLoo3EwjmAN2Pup/qhTtiqM9xNfa +GuN+NX4zjkra+T2NEywIykwhodaFiYB+r6xM0LIHANlKKT7kRtgzkq/s8ui6Wkt b94T8BpE5U3f6YGz/4NtbqpYS6XVjIIjfP5MxoHRCh8H2LXmWs9A2RlmuZAwo0M2 FJjxcfIgvHrgCerPogVcXYT23BavOhMFlx7Jck2GAbDg0HYTabZuLNkj9T1//raL aknXJxuLYHbZe6I1cbsIdXJjav5c83YgqGDKetcJdkQqMgk8lVWW7RIdLb0= -----END CERTIFICATE----- EOF kubectl config --kubeconfig=flink-kubeconfig set-cluster base --server=https://cls-xxxxxxx.</description>
    </item>
    
    <item>
      <title>è®°ä¸€æ¬¡ IPVS å¼•èµ·çš„ kubernetes æœåŠ¡å¼‚å¸¸</title>
      <link>https://mydream.ink/posts/cloud-native/kubernetes/record-a-kubernetes-service-exception-caused-by-ipvs/</link>
      <pubDate>Sun, 06 Dec 2020 17:14:02 +0800</pubDate>
      
      <guid>https://mydream.ink/posts/cloud-native/kubernetes/record-a-kubernetes-service-exception-caused-by-ipvs/</guid>
      <description>é—®é¢˜æè¿° åœ¨æˆ‘ä»¬çš„ç¯å¢ƒä¸­ï¼Œä¸šåŠ¡ A ä¼šè®¿é—®ä¸šåŠ¡ Bï¼ˆä¹Ÿå³ B æ˜¯ A çš„ä¸Šæ¸¸æœåŠ¡ï¼‰ï¼Œå½“ B å‘ç‰ˆæ—¶ï¼ŒA çš„è¯·æ±‚å¶å°”ä¼šå‡ºç° timeoutã€‚ç°è±¡çœ‹èµ·æ¥æ˜¯æµé‡è·¯ç”±åˆ°äº†å·²ç»ä¸èƒ½æä¾›æœåŠ¡çš„è€çš„ pod ä¸­ã€‚
é—®é¢˜å¤„ç† æ’æŸ¥ç‚¹ä¸€ å½“ pod ä¸‹çº¿æ—¶ï¼Œendpoint controller æœªåŠæ—¶å°† pod ä» endpoint ä¸­å–å‡ºï¼Œå¯¼è‡´æµé‡è¿›å…¥äº†æ—§çš„ podã€‚
ç”±äºé›†ç¾¤ master æ˜¯æ‰˜ç®¡éƒ¨ç½²çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡æœ‰åŠæ³•æŸ¥çœ‹ç›¸å…³æ—¥å¿—å’Œè´Ÿè½½ï¼Œæ±‚åŠ©äºè…¾è®¯äº‘çš„åŒæ—¶ï¼Œè‡ªå·±è¿™è¾¹ä¹Ÿåœ¨æ’æŸ¥ã€‚æ’æŸ¥åˆ†ä¸¤æ­¥è¿›è¡Œï¼Œç›‘æ§æœåŠ¡ B endpoint çš„å˜åŒ–ï¼ŒåŒæ—¶æ»šåŠ¨é‡å¯è¯¥æœåŠ¡ã€‚
  ç›‘æ§ ep å˜åŒ–
watch -n 1 kubectl -n production describe ep wk-dispatcher   é‡å¯æœåŠ¡
kubectl -n production rollout restart deployment wk-dispatcher   é€šè¿‡æ’æŸ¥å‘ç°ï¼Œè·Ÿ endpoint controller å¹¶æ²¡æœ‰å…³ç³»ï¼Œå› ä¸º ep å˜åŒ–å¾ˆåŠæ—¶ï¼ŒåŠ ä¸Šè‡³å°‘ 30 ç§’çš„ä¼˜é›…ç»ˆæ­¢æ—¶é—´ï¼ŒåŸºæœ¬å¯ä»¥ç¡®å®šåœ¨æœåŠ¡ç»“æŸå‰ï¼Œpod æ˜¯ä» ep ä¸­ç§»é™¤äº†çš„ã€‚</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ cert-manager è‡ªåŠ¨ç®¡ç† tls è¯ä¹¦</title>
      <link>https://mydream.ink/posts/cloud-native/kubernetes/use-cert-manager-in-kubernetes/</link>
      <pubDate>Sat, 09 Nov 2019 08:49:39 +0800</pubDate>
      
      <guid>https://mydream.ink/posts/cloud-native/kubernetes/use-cert-manager-in-kubernetes/</guid>
      <description>http åè®®æ˜¯ä¸€ä¸ªå…¨æ˜æ–‡ä¼ è¾“çš„åè®®ï¼Œä¸åŠ ä»»ä½•å¤„ç†çš„ http æŠ¥æ–‡å°†åœ¨å› ç‰¹ç½‘ä¸­è£¸å¥”ï¼Œåªè¦æœ‰äººå¯¹ç›‘å¬ä½ çš„æŠ¥æ–‡ï¼Œä½ æ‰€æœ‰éšç§å°†è¢«äººä¸€è§ˆæ— ä½™ã€‚Letâ€™s Encrypt æ˜¯ä¸€å®¶å…è´¹ã€å¼€æ”¾ã€è‡ªåŠ¨åŒ–çš„è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰ï¼Œä¸ºå…¬ä¼—çš„åˆ©ç›Šè€Œè¿è¡Œã€‚å®ƒæ˜¯ä¸€é¡¹ç”± Internet Security Research Groupï¼ˆISRGï¼‰æä¾›çš„æœåŠ¡ã€‚æœ¬ç€æƒ³è¦åˆ›å»ºä¸€ä¸ªæ›´å®‰å…¨ï¼Œæ›´å°Šé‡éšç§çš„ Web ç¯å¢ƒçš„åˆè¡·ï¼ŒLetâ€™s Encrypt ä»¥å°½å¯èƒ½å¯¹ç”¨æˆ·å‹å¥½çš„æ–¹å¼å…è´¹æä¾›ä¸ºç½‘ç«™å¯ç”¨ HTTPSï¼ˆSSL/TLSï¼‰æ‰€éœ€çš„æ•°å­—è¯ä¹¦ã€‚
ä½†æ˜¯ Letâ€™s Encrypt é¢å‘çš„è¯ä¹¦æœ‰ä¸ªç‰¹ç‚¹ï¼Œæœ‰æ•ˆæœŸåªæœ‰ä¸‰ä¸ªæœˆã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦é¢‘ç¹ç»­æœŸè¯ä¹¦ï¼Œå€˜è‹¥æ‰‹åŠ¨ç»­æœŸï¼Œæ— ç–‘ä¼šå¢åŠ è¿ç»´æˆæœ¬ã€‚æœ‰ä»€ä¹ˆæ–¹å¼å¯ä»¥ä¸ºæˆ‘ä»¬è‡ªåŠ¨é¢å‘è¯ä¹¦å—ï¼Ÿå½“ç„¶æœ‰ï¼ACME æ— ç–‘å°±æ˜¯æˆ‘ä»¬çš„æœ€ä½³é€‰æ‹©ã€‚
æœ‰ä¸€æ¬¾å¾ˆå¥½ç”¨çš„ ACME å®¢æˆ·ç«¯å« Certbotï¼Œå¯ä»¥å¸®åŠ©è‡ªåŠ¨é¢å‘ã€ç»­æœŸè¯ä¹¦ã€‚åœ¨ kubernetes çš„ç”Ÿæ€ä¸­æœ‰æ²¡æœ‰ä»€ä¹ˆå¥½çš„å·¥å…·èƒ½å¸®åŠ©æˆ‘ä»¬éå¸¸æ–¹ä¾¿åœ°ä½¿ç”¨è¯ä¹¦ä¹ˆï¼Ÿå½“ç„¶æœ‰ï¼Œé‚£å°±æ˜¯æœ¬æœŸä¸»é¢˜â€”â€”cert-managerã€‚
cert-manager æ˜¯æœ¬åœ° Kubernetes è¯ä¹¦ç®¡ç†æ§åˆ¶å™¨ã€‚å®ƒå¯ä»¥å¸®åŠ©ä»å„ç§æ¥æºé¢å‘è¯ä¹¦ï¼Œä¾‹å¦‚ Let&amp;rsquo;s Encryptï¼ŒHashiCorp Vaultï¼ŒVenafiï¼Œç®€å•çš„ç­¾åå¯†é’¥å¯¹æˆ–è‡ªç­¾åã€‚å®ƒå°†ç¡®ä¿è¯ä¹¦æœ‰æ•ˆå¹¶ä¸”æ˜¯æœ€æ–°çš„ï¼Œå¹¶åœ¨åˆ°æœŸå‰å°è¯•åœ¨é…ç½®çš„æ—¶é—´ç»­è®¢è¯ä¹¦ã€‚
åŸç†æ¯”è¾ƒç®€å•ï¼Œæœ¬æ–‡å°±ä¸è®²äº†ï¼Œä¸»è¦è°ˆè°ˆæ¥å®‰è£…å’Œä½¿ç”¨ã€‚
å®‰è£… YAML å®‰è£…   åˆ›å»º namespace
kubectl create namespace cert-manager   å®‰è£… crd å’Œ cert-manager
kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v0.11.0/cert-manager.yaml  å€¼å¾—è¯´æ˜çš„æ˜¯ï¼šåœ¨ kubernetes 1.15 ä»¥å‰çš„ç‰ˆæœ¬éœ€è¦åœ¨æ‰§è¡Œkubectl applyæ—¶æ·»åŠ ä¸€ä¸ªå‚æ•°--validate=falseï¼Œå¦åˆ™åœ¨åˆ›å»º CustomResourceDefinition èµ„æºæ—¶ä¼šæ”¶åˆ°ä¸ x-kubernetes-preserve-unknown-fields å­—æ®µæœ‰å…³çš„éªŒè¯é”™è¯¯ã€‚
   helm å®‰è£… ä¾æ¬¡æ‰§è¡Œä¸‹è¿°å‘½ä»¤ï¼š</description>
    </item>
    
    <item>
      <title>åœ¨ Mac ä¸Šä½¿ç”¨ Docker è‡ªå¸¦çš„ Kubernetes</title>
      <link>https://mydream.ink/posts/cloud-native/kubernetes/use-kubernetes-from-docker-on-mac/</link>
      <pubDate>Fri, 12 Jul 2019 20:23:13 +0800</pubDate>
      
      <guid>https://mydream.ink/posts/cloud-native/kubernetes/use-kubernetes-from-docker-on-mac/</guid>
      <description>Mac å®‰è£… Docker çš„æ–¹æ³•ä¸å†èµ˜è¿°ï¼Œå¾ˆç®€å•ï¼Œå®˜æ–¹ä¸‹è½½å®‰è£…å³å¯ã€‚
å®‰è£…å®Œæˆåï¼Œkubectlçš„äºŒè¿›åˆ¶æ–‡ä»¶å°±å·²ç»å­˜åœ¨äº†ã€‚æˆ‘ä»¬ä»…éœ€è¦ä¸‹è½½é•œåƒï¼Œå¼€å¯ kubernetesã€‚
ä¸‹è½½é•œåƒ æŸ¥çœ‹ä¸€ä¸‹ä½ çš„ Docker å’Œ Kubernetes ç‰ˆæœ¬ï¼š
ä½¿ç”¨ä»¥ä¸‹è„šæœ¬ï¼Œè®°å¾—å°†é•œåƒç‰ˆæœ¬æ”¹æˆä½ æ‰€éœ€è¦çš„ğŸ
#!/bin/bash  set -e KUBE_VERSION=v1.10.11 KUBE_PAUSE_VERSION=3.1 ETCD_VERSION=3.1.12 DNS_VERSION=1.14.8 DOCKER_TOOL_VERSION=v0.4.12 GCR_URL=k8s.gcr.io ALIYUN_URL=registry.cn-hangzhou.aliyuncs.com/google_containers images=(kube-proxy-amd64:${KUBE_VERSION} kube-scheduler-amd64:${KUBE_VERSION} kube-controller-manager-amd64:${KUBE_VERSION} kube-apiserver-amd64:${KUBE_VERSION} pause-amd64:${KUBE_PAUSE_VERSION} etcd-amd64:${ETCD_VERSION} k8s-dns-sidecar-amd64:${DNS_VERSION} k8s-dns-kube-dns-amd64:${DNS_VERSION} k8s-dns-dnsmasq-nanny-amd64:${DNS_VERSION}) for image in ${images[@]} ; do docker pull ${ALIYUN_URL}/${image} docker tag ${ALIYUN_URL}/${image} ${GCR_URL}/${image} docker rmi ${ALIYUN_URL}/${image} done # æ‹‰å– Docker ç›¸å…³é•œåƒ docker pull docker/kube-compose-api-server:${DOCKER_TOOL_VERSION} docker pull docker/kube-compose-controller:${DOCKER_TOOL_VERSION} æ‰§è¡Œè¯¥è„šæœ¬ï¼Œå°†ä»é˜¿é‡Œé•œåƒåº“è·å¾—æ‰€éœ€é•œåƒã€‚
å¯åŠ¨ Kubernetes åŠŸèƒ½ æ‰“å¼€ Docker é…ç½®é¢æ¿ï¼Œè¯·è‡³å°‘å‹¾é€‰ Enable Kubernetes ä»¥å¼€å¯ Kubernetes æœåŠ¡ã€‚</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ kubeadm å®‰è£… Kubernetes 1.10.0</title>
      <link>https://mydream.ink/posts/cloud-native/kubernetes/kubeadm/</link>
      <pubDate>Fri, 09 Mar 2018 00:00:00 +0000</pubDate>
      
      <guid>https://mydream.ink/posts/cloud-native/kubernetes/kubeadm/</guid>
      <description>kuberneteså¯ä»¥ä½¿ç”¨å¤šç§å®¹å™¨runtimeï¼Œæ­¤å¤„ä½¿ç”¨å½“å‰æœ€å¸¸è§çš„dockerã€‚
å®‰è£…docker åœ¨å„ç§æœºå™¨ä¸Šå®‰è£…dockerçš„æ–¹å¼ä¸åŒï¼Œæˆ‘æ›¾ç¿»è¯‘è¿‡ä¸€ç¯‡ubuntuå®‰è£…dockerçš„æ–‡ç« ï¼Œè¿˜æœ‰ä¸€äº›æ²¡æ¥çš„åŠç¿»è¯‘çš„ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚æ¨èçš„dockerç‰ˆæœ¬ä¸ºv1.12ï¼Œv1.11, v1.13 å’Œ 17.03 ä¹Ÿè¡Œï¼Œå…¶å®ƒçš„å®˜æ–¹å°±æ²¡æµ‹è¯•è¿‡äº†ï¼Œä¸è¿‡æˆ‘ä½¿ç”¨å½“å‰æœ€æ–°çš„v18.03ä¹Ÿè¡Œã€‚
dockerå®˜æ–¹  ä½¿ç”¨Ubuntuå®‰è£…docker-ce Macå’ŒWindowsæ¡Œé¢å®‰è£…docker-ce  ä¸‹è½½Macç‰ˆæœ¬çš„docker-ceï¼Œæ‰§è¡Œå³å®‰è£… ä¸‹è½½Windowsç‰ˆæœ¬çš„docker-ceï¼Œæ‰§è¡Œå³å¯å®‰è£…   CentOSå®‰è£…docker-ce Fedoraå®‰è£…docker-ce äºŒè¿›åˆ¶å®‰è£…æ–¹å¼  kubernetesæ¨è   Ubuntu/Debian/HypriotOS ä»Ubuntuçš„åº“å®‰è£…
apt-get update apt-get install -y docker.io ä½¿ç”¨dockeråº“å®‰è£…v17.03
apt-get update apt-get install -y \  apt-transport-https \  ca-certificates \  curl \  software-properties-common curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add - add-apt-repository \  &amp;#34;deb https://download.docker.com/linux/$(. /etc/os-release; echo &amp;#34;$ID&amp;#34;)\ $(lsb_release -cs)\ stable&amp;#34; apt-get update &amp;amp;&amp;amp; apt-get install -y docker-ce=$(apt-cache madison docker-ce | grep 17.</description>
    </item>
    
  </channel>
</rss>
